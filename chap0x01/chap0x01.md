# ğŸ’»å®éªŒä¸€ï¼šåŸºäº VirtualBox çš„ç½‘ç»œæ”»é˜²åŸºç¡€ç¯å¢ƒæ­å»º



## å®éªŒç›®çš„

- æŒæ¡ VirtualBox è™šæ‹Ÿæœºçš„å®‰è£…ä¸ä½¿ç”¨ï¼›
- æŒæ¡ VirtualBox çš„è™šæ‹Ÿç½‘ç»œç±»å‹å’ŒæŒ‰éœ€é…ç½®ï¼›
- æŒæ¡ VirtualBox çš„è™šæ‹Ÿç¡¬ç›˜å¤šé‡åŠ è½½ï¼›

## å®éªŒç¯å¢ƒ

æœ¬æ¬¡å®éªŒéœ€è¦ä½¿ç”¨çš„ç½‘ç»œèŠ‚ç‚¹è¯´æ˜ï¼š

- VirtualBox è™šæ‹Ÿæœº
- æ”»å‡»è€…ä¸»æœºï¼ˆAttackerï¼‰ï¼šKali
- ç½‘å…³ï¼ˆGateway, GWï¼‰ï¼šDebian
- é¶æœºï¼ˆVictimï¼‰ï¼šDebian / xp-sp3 / Kali

## å®éªŒè¦æ±‚

- [x] è™šæ‹Ÿç¡¬ç›˜é…ç½®æˆå¤šé‡åŠ è½½

- [x] æ­å»ºæ»¡è¶³å¦‚ä¸‹æ‹“æ‰‘å›¾æ‰€ç¤ºçš„è™šæ‹Ÿæœºç½‘ç»œæ‹“æ‰‘ï¼›
- [x] <img src="https://c4pr1c3.github.io/cuc-ns/chap0x01/attach/chap0x01/media/vb-exp-layout.png" style="zoom:50%;" />

- [x] å®Œæˆä»¥ä¸‹ç½‘ç»œè¿é€šæ€§æµ‹è¯•ï¼›
  - [x] é¶æœºå¯ä»¥ç›´æ¥è®¿é—®æ”»å‡»è€…ä¸»æœº
  - [x] æ”»å‡»è€…ä¸»æœºæ— æ³•ç›´æ¥è®¿é—®é¶æœº
  - [x] ç½‘å…³å¯ä»¥ç›´æ¥è®¿é—®æ”»å‡»è€…ä¸»æœºå’Œé¶æœº
  - [x] é¶æœºçš„æ‰€æœ‰å¯¹å¤–ä¸Šä¸‹è¡Œæµé‡å¿…é¡»ç»è¿‡ç½‘å…³
  - [x] æ‰€æœ‰èŠ‚ç‚¹å‡å¯ä»¥è®¿é—®äº’è”ç½‘



## å®éªŒæ­¥éª¤

### ä¸€ã€é…ç½®è™šæ‹Ÿç¡¬ç›˜å¤šé‡åŠ è½½

é¦–å…ˆæŒ‰ç…§æ‹“æ‰‘å›¾ç¤ºå¯¼å…¥è™šæ‹Ÿæœºï¼Œå¹¶å¯¼å…¥ç›¸åº”çš„vdiæ–‡ä»¶ï¼Œç„¶åç‚¹å‡»ç®¡ç†â€”â€”è™šæ‹Ÿä»‹è´¨ç®¡ç†â€”â€”ç‚¹å‡»æ¯ä¸€ä¸ªè™šæ‹Ÿç¡¬ç›˜çš„åç§°ï¼Œåœ¨å±æ€§é‡Œå°†ä»–ä»¬é…ç½®æˆå¤šé‡åŠ è½½ï¼Œç„¶åç‚¹å‡»åº”ç”¨ã€‚

![è™šæ‹Ÿä»‹è´¨](img/xunijiezhi.png)

![å¤šé‡åŠ è½½](img/more-jiazai.png)

![å¤šé‡åŠ è½½](img/duochongjiazai.png)



### äºŒã€æ­å»ºè™šæ‹Ÿæœºç½‘ç»œæ‹“æ‰‘

#### 1ã€æ‰“å¼€æ¯å°è™šæ‹Ÿæœºï¼Œåœ¨è®¾ç½®ä¸­è¿›è¡Œç½‘å¡çš„é…ç½®

##### ï¼ˆ1ï¼‰**Gatewayç½‘å…³**ç½‘å¡é…ç½®ï¼ˆ4å—ï¼‰

- ç¬¬ä¸€å—ï¼šNATç½‘ç»œï¼›
- ç¬¬äºŒå—ï¼šä¸»æœºï¼ˆHost-Onlyï¼‰ç½‘ç»œï¼›
- ç¬¬ä¸‰å—ï¼šå†…éƒ¨ç½‘ç»œintnet1ï¼Œæ­å»ºå±€åŸŸç½‘1ï¼›
- ç¬¬ä¸‰å—ï¼šå†…éƒ¨ç½‘ç»œintnet2ï¼Œæ­å»ºå±€åŸŸç½‘2ã€‚
- åœ¨æ­¤ç•Œé¢å¯¹ç½‘å¡è¿›è¡Œä¾æ¬¡è®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤º

| è™šæ‹Ÿæœºåç§°    | ä½œç”¨   |
| ------------- | ------ |
| Debian10      | ç½‘å…³   |
| kali-attacker | æ”»å‡»è€… |
| windowsXP     | é¶æœº   |
| 2-windowsXP   | é¶æœº   |
| 2-Debian10    | é¶æœº   |
| kali-victim   | é¶æœº   |

![ç½‘å¡é…ç½®1](img/ç½‘å¡é…ç½®1.png)

![ç½‘å¡é…ç½®2](img/ç½‘å¡é…ç½®2.png)

![ç½‘å¡é…ç½®3](img/ç½‘å¡é…ç½®3.png)

##### ï¼ˆ2ï¼‰**Attackeræ”»å‡»è€…**éœ€ä¸‰å—ç½‘å¡

- ç¬¬ä¸€å—ï¼šNATç½‘ç»œï¼›
- ç¬¬äºŒå—ï¼šä¸»æœºï¼ˆHost-Onlyï¼‰ç½‘ç»œï¼›
- ç¬¬ä¸‰å—ï¼šä¸»æœºï¼ˆHost-Onlyï¼‰ç½‘ç»œï¼›**ä¸ç¬¬äºŒå—ä¸ä¸€æ ·**ï¼Œå…·ä½“é…ç½®è§å›¾ï¼›

- **å…¶ä»–çš„å®éªŒé¶æœº**éƒ½åªéœ€è¦ä¸€å—ç½‘å¡
  - åˆ†ä¸ºä¸¤ç»„ï¼Œä½¿å¾—ä¸åŒçš„å®éªŒå—å®³ä¸»æœºåœ¨ä¸åŒçš„å±€åŸŸç½‘é‡Œï¼›
  - Windows xp1 ä¸ kali 2å·åœ¨ç¬¬ä¸€å±€åŸŸç½‘ï¼ˆintnet1ï¼‰ï¼› 
  - Windows xp2 ä¸ debian 2å·åœ¨ç¬¬äºŒå±€åŸŸç½‘ï¼ˆintnet2ï¼‰ï¼›

### ä¸‰ã€å®Œæˆä»¥ä¸‹ç½‘ç»œè¿é€šæ€§æµ‹è¯•

#### 1ã€é¶æœºå¯ä»¥ç›´æ¥è®¿é—®æ”»å‡»è€…ä¸»æœº

##### ï¼ˆ1ï¼‰æµ‹è¯•å±€åŸŸç½‘1å†…çš„ä¸»æœºä¸Attackerçš„è¿é€šæ€§

- é¶æœºå¯ç›´æ¥è®¿é—®Attacker

  ![é¶æœºç›´æ¥è®¿é—®Attacker](img/winxp-ping.png)

##### ï¼ˆ2ï¼‰æµ‹è¯•å±€åŸŸç½‘2å†…çš„ä¸»æœºä¸Attackerçš„è¿é€šæ€§

- é¶æœºå¯ç›´æ¥è®¿é—®Attacker

![é¶æœºå¯ç›´æ¥è®¿é—®Attacker](img/windowsxp2.png)



#### 2ã€æ”»å‡»è€…ä¸»æœºæ— æ³•ç›´æ¥è®¿é—®é¶æœº

##### ï¼ˆ1ï¼‰æµ‹è¯•å±€åŸŸç½‘1å†…çš„ä¸»æœºä¸Attackerçš„è¿é€šæ€§

- Attackerä¸å¯ç›´æ¥è®¿é—®é¶æœº

![Attackerä¸å¯ç›´æ¥è®¿é—®é¶æœº](img/æ”»å‡»è€…pingä¸é€šå±€åŸŸç½‘1é¶æœº.png)



##### ï¼ˆ2ï¼‰æµ‹è¯•**å±€åŸŸç½‘2å†…çš„ä¸»æœºä¸Attackerçš„è¿é€šæ€§

- Attackerä¸å¯ç›´æ¥è®¿é—®é¶æœº

  ![Attackerä¸å¯ç›´æ¥è®¿é—®é¶æœº](img/attack-ping-debain.png)

#### 3ã€ç½‘å…³å¯ä»¥ç›´æ¥è®¿é—®æ”»å‡»è€…ä¸»æœºå’Œé¶æœº

##### ï¼ˆ1ï¼‰ç½‘å…³è®¿é—®Attacker

![ç½‘å…³è®¿é—®Attacker](img/debian-ç½‘å…³è®¿é—®acctter.png)

##### ï¼ˆ2ï¼‰ç½‘å…³è®¿é—®å±€åŸŸç½‘1é¶æœº

![ç½‘å…³è®¿é—®ç¬¬ä¸€å±€åŸŸç½‘é¶æœº](img/ç½‘å…³ping-kali-vim.png)

##### ï¼ˆ3ï¼‰ç½‘å…³è®¿é—®å±€åŸŸç½‘2é¶æœº

![ç½‘å…³è®¿é—®å±€åŸŸç½‘2çš„ä¸»æœº](img/ç½‘å…³è®¿é—®å±€åŸŸç½‘2çš„ä¸»æœº.png)

### 4.é¶æœºçš„æ‰€æœ‰å¯¹å¤–ä¸Šä¸‹è¡Œæµé‡å¿…é¡»ç»è¿‡ç½‘å…³

è®©é¶æœºä¸äº’è”ç½‘è¿›è¡Œäº’é€šï¼Œåœ¨äº’é€šçš„è¿‡ç¨‹ä¸­ç”¨ç½‘å…³è¿›è¡ŒæŠ“åŒ…ï¼Œå¦‚æœé¶æœºå‘é€çš„æ‰€æœ‰åŒ…éƒ½èƒ½è¢«ç½‘å…³æŠ“åˆ°ï¼Œåˆ™è¯´æ˜é¶æœºçš„æ‰€æœ‰å¯¹å¤–ä¸Šä¸‹è¡Œæµé‡å¿…é¡»ç»è¿‡ç½‘å…³ã€‚

##### ï¼ˆ1ï¼‰å±€åŸŸç½‘1é¶æœº

- è¿æ¥ä¸Šäº’è”ç½‘å¹¶ç”¨ç½‘å…³æŠ“åŒ…

- æŠ“åŒ…è¯­å¥ï¼š

  ```bash
  sudo tcpdump -c 5
  ```

- ![ç¬¬ä¸€å±€åŸŸç½‘é¶æœºæŠ“åŒ…](img/int1-zhuabao.png)

##### ï¼ˆ2ï¼‰å±€åŸŸç½‘2é¶æœº

- è”é€šäº’è”ç½‘å¹¶ç”¨ç½‘å…³æŠ“åŒ…

  ```bash
  sudo tcpdump -c 5
  ```

- ![ç¬¬ä¸€å±€åŸŸç½‘é¶æœºæŠ“åŒ…](img/int2zhuabao.png)

##### ï¼ˆ3ï¼‰æŠ“åŒ…æ•°æ®æ–‡ä»¶å¤åˆ¶åˆ°ä¸»æœºç”¨WireSharkåˆ†æï¼Œå‘ç°æ˜¯å¯ä»¥å¯¹ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´é¶æœºæ‰€æœ‰ä¸Šè¿‡æµé‡å¿…é¡»ç»è¿‡ç½‘å…³ã€‚

é¦–å…ˆç”¨winscpè¿æ¥ä¸Šå¯¹åº”ä¸»æœºï¼Œç„¶åå°±å¯ä»¥ç›´æ¥æŠŠè™šæ‹Ÿæœºé‡Œçš„æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ä¸Šã€‚

```bash
# å®‰è£…tcpdump
apt install tcpdump
apt update && apt install tmux

# æŠ“åŒ…
cd workspace
tcpdump -i enp0s9 -n -w 20220918.5.pcap

ping www.baidu.com
```

![å®‰è£…tcpdump](img/zhuabao.png)

### 5.æ‰€æœ‰èŠ‚ç‚¹å‡å¯ä»¥è®¿é—®äº’è”ç½‘

##### ï¼ˆ1ï¼‰Attackerå¯æ­£å¸¸è®¿é—®äº’è”ç½‘

![Attackerå¯æ­£å¸¸è®¿é—®äº’è”ç½‘](img/æ”»å‡»è€…å¯æ­£å¸¸è®¿é—®äº’è”ç½‘.png)

##### ï¼ˆ2ï¼‰å±€åŸŸç½‘1é¶æœºå¯æ­£å¸¸è®¿é—®äº’è”ç½‘

![å±€åŸŸç½‘1é¶æœºå¯æ­£å¸¸è®¿é—®äº’è”ç½‘](img/å±€åŸŸç½‘1å†…çš„é¶æœºå¯æ­£å¸¸è®¿é—®äº’è”ç½‘.png)

##### ï¼ˆ3ï¼‰å±€åŸŸç½‘2é¶æœºå¯æ­£å¸¸è®¿é—®äº’è”ç½‘

![å±€åŸŸç½‘2é¶æœºå¯æ­£å¸¸è®¿é—®äº’è”ç½‘](img/å±€åŸŸç½‘2å†…çš„é¶æœºå¯æ­£å¸¸è®¿é—®äº’è”ç½‘.png)

##### ï¼ˆ4ï¼‰ç½‘å…³å¯æ­£å¸¸è®¿é—®äº’è”ç½‘

![ç½‘å…³å¯æ­£å¸¸è®¿é—®äº’è”ç½‘](img/ç½‘å…³å¯æ­£å¸¸è®¿é—®äº’è”ç½‘.png)



## å®éªŒé‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

ï¼ˆ1ï¼‰å¯¼å…¥è™šæ‹Ÿæœºåçš„å­˜å‚¨é‡Œé¢ã€‚éœ€è¦æœ‰SATAè¿™ä¸ªæ§åˆ¶å™¨ï¼Œè¿™ä¸ªå¯ä»¥åæœŸæ·»åŠ ï¼Œä¸ç„¶ä¼šæŠ¥ä¸€äº›å¥‡æ€ªçš„é”™ã€‚

ï¼ˆ2ï¼‰å¦‚æœè™šæ‹Ÿæœºæ‰“ä¸å¼€è¿˜æ˜¯å‡ºé”™ï¼Œè¯·åˆ é™¤å®ƒé‡æ–°å¯¼å…¥ï¼Œä¸è¦çŠ¹è±«ã€‚

ï¼ˆ3ï¼‰pingçš„æ—¶å€™æœ¬è¯¥è¿é€šï¼Œä½†æ˜¯å¦‚æœpingä¸é€šï¼Œå¯ä»¥è€ƒè™‘æ˜¯é˜²ç«å¢™æ²¡æœ‰å…³é—­çš„åŸå› ï¼Œå…³é—­é˜²ç«å¢™å³å¯ã€‚

```bash
#å®‰è£…ufw
apt-get install ufw

#æŸ¥çœ‹é˜²ç«å¢™ç°æœ‰è§„åˆ™ï¼š
ufw status

#å¼€å¯/å…³é—­é˜²ç«å¢™ï¼š
ufw enable  #å¼€å¯
ufw disable #å…³é—­
```

ï¼ˆ4ï¼‰æŠ“åŒ…åæƒ³æŠŠæ–‡ä»¶å¯¼å‡ºï¼Œå¹¶ç”¨wiresharkæŸ¥çœ‹æ—¶ä¼šæŠ¥é”™ï¼Œåå¤å°è¯•è¿‡scp,vscode,winscpåä¾æ—§ä¼šæŠ¥é”™ï¼Œå…·ä½“å¦‚ä¸‹ã€‚

![error](img/error.png)

```
ã€æ›´æ”¹å¯†ç ã€‘ï¼š

1.vim /etc/ssh/sshd_config

æ–‡ä»¶ä¸­PermitEmptyPasswords noæ”¹æˆyes

é‡å¯æœåŠ¡
service ssh restart

2.æ›´æ”¹å¯†ç 
sudo passwd root

3.æ ¸å¯¹å¯†ç å†æ¬¡ç™»å½•
```

```
ã€æ›´æ”¹æ–‡ä»¶é…ç½®ã€‘

#PermitRootLogin yes
#å…è®¸rootç™»å½•ï¼Œè®¾ä¸ºyesã€‚
#PermitRootLogin prohibit-password 
#å…è®¸rootç™»å½•ï¼Œä½†æ˜¯ç¦æ­¢rootç”¨å¯†ç ç™»å½•
#å¾ˆæ˜æ˜¾è¿™è¡Œæ˜¯éœ€è¦è¢«æ³¨é‡Šæ‰çš„ï¼ï¼ï¼

#sudo vim /etc/ssh/sshd_config

æ‰¾åˆ°å¹¶ç”¨#æ³¨é‡Šæ‰è¿™è¡Œï¼šPermitRootLogin prohibit-password

æ–°å»ºä¸€è¡Œ æ·»åŠ ï¼šPermitRootLogin yes

é‡å¯æœåŠ¡

#sudo service ssh restart
```

![æŠ¥é”™](img/æŠ¥é”™.png)

ç„¶åå°±å¯ä»¥å•¦ï¼å°±æ˜¯å› ä¸ºå®ƒä¸å…è®¸rootè®¿é—®æ‰€ä»¥é€ æˆçš„è¿æ¥ä¸ä¸Šï¼Œåªè¦æŠŠrootå¯¹åº”çš„æƒé™å…³äº†å°±è¡Œã€‚

(5)é¶æœºçš„ipè¿ä¸ä¸Šæˆ–è€…æŸ¥ä¸å‡ºæ¥

- é…ç½®ä¸¤å—ä¸åŒçš„Host-onlyç½‘å¡

  ç®¡ç†->ä¸»æœºç½‘ç»œç®¡ç†å™¨->åˆ›å»ºä¸€ä¸ªæ–°çš„host-onlyç½‘å¡å¹¶å¯ç”¨DHCPæœåŠ¡

- ä¿®æ”¹é…ç½®æ–‡ä»¶ ã€‚æ·»åŠ ä»¥ä¸‹ä¿¡æ¯ï¼Œå°†`eth1`å’Œ`eth2`è¿™ä¸¤å—ç½‘å¡ä¿®æ”¹ä¸º**å¼€æœºè‡ªå¯åŠ¨**ï¼Œå¹¶ä¸”**å†™å…¥dhcpæœåŠ¡**ä»è€ŒåŠ¨æ€è·å–è·¯ç”±åˆ†é…çš„ipã€‚

```bash
sudo vim /etc/network/interfaces

auto eth1 
iface eth1 inet dhcp #é…ç½®eth1ä½¿ç”¨DHCPåè®®
auto eth2
iface eth2 inet dhcp #é…ç½®eth2ä½¿ç”¨DHCPåè®®

# é‡å¯ç½‘å¡ï¼Œå³ä¸Šè§’ä¼šå‡ºç°æ–­å¼€ç½‘ç»œçš„å›¾æ ‡
/etc/init.d/network-manager restart
```

- ç„¶åé‡å¯è™šæ‹Ÿæœºï¼Œç­‰å¾…ä¸€ä¼šå°±èƒ½æŸ¥å‡ºæ¥äº†ã€‚



## å‚è€ƒé“¾æ¥

- [ç½‘å¡é…ç½®](https://blog.csdn.net/hexf9632/article/details/110197530)
- [virtual boxå®‰è£…Linuxç³»ç»Ÿå¹¶å…³é—­é˜²ç«å¢™](https://mbd.baidu.com/ma/s/nShWHTqN)
- [å¦‚ä½•åœ¨Debianä¸Šæ›´æ”¹rootå¯†ç ï¼Ÿ](https://qastack.cn/unix/10095/how-do-you-change-the-root-password-on-debian)
- [WinSCP ä»¥é¢„è®¾å¯†ç è¿›è¡ŒéªŒè¯ æ‹’ç»è®¿é—®](https://blog.csdn.net/weixin_42672685/article/details/123824826)
- [winSCPä»¥é¢„ç½®å¯†ç è¿›è¡ŒéªŒè¯](https://www.codeleading.com/article/11643563991/)
- [å…³äºæ‹’ç»ç”¨æˆ·è®¿é—®](https://www.cnblogs.com/miaodi/p/6718950.html)

























